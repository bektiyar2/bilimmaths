<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilimMath ‚Äî Global Multilingual</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .math-card { box-shadow: 0 20px 60px rgba(93, 95, 239, 0.15); border-radius: 40px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .rank-gold { background: linear-gradient(45deg, #FFD700, #FFA500); color: white; }
    </style>
</head>
<body class="bg-[#F4F7FF] min-h-screen flex items-center justify-center p-4">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDYcopzuJzFYm2T0-GonGA4YQqpzz5egxw",
            authDomain: "bilimmath-a3e1e.firebaseapp.com",
            projectId: "bilimmath-a3e1e",
            storageBucket: "bilimmath-a3e1e.firebasestorage.app",
            messagingSenderId: "1016139764877",
            appId: "1:1016139764877:web:f9de05ef243efb41823ec4",
            databaseURL: "https://bilimmath-a3e1e-default-rtdb.europe-west1.firebasedatabase.app"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.database();

        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const taskGenerators = {
            1: [
                { id: 'add', kk: '“ö–æ—Å—É', ru: '–°–ª–æ–∂–µ–Ω–∏–µ', gen: () => { const a=randomInt(1,10), b=randomInt(1,10); return { q: {kk:`${a} + ${b}`, ru:`${a} + ${b}`}, ans: a+b }; } },
                { id: 'sub', kk: '–ê–∑–∞–π—Ç—É', ru: '–í—ã—á–∏—Ç–∞–Ω–∏–µ', gen: () => { const a=randomInt(5,15), b=randomInt(1,a); return { q: {kk:`${a} - ${b}`, ru:`${a} - ${b}`}, ans: a-b }; } }
            ],
            2: [
                { id: 'mult', kk: '–ö”©–±–µ–π—Ç—É', ru: '–£–º–Ω–æ–∂–µ–Ω–∏–µ', gen: () => { const a=randomInt(2,5), b=randomInt(2,9); return { q: {kk:`${a} √ó ${b}`, ru:`${a} √ó ${b}`}, ans: a*b }; } },
                { id: 'time', kk: '–£–∞“õ—ã—Ç', ru: '–í—Ä–µ–º—è', gen: () => { const h=randomInt(1,3); return { q: {kk:`${h} —Å–∞“ì–∞—Ç—Ç–∞ –Ω–µ—à–µ –º–∏–Ω –±–∞—Ä?`, ru:`–°–∫–æ–ª—å–∫–æ –º–∏–Ω –≤ ${h} —á–∞—Å–∞—Ö?`}, ans: h*60 }; } }
            ],
            3: [
                { id: 'div', kk: '–ë”©–ª—É', ru: '–î–µ–ª–µ–Ω–∏–µ', gen: () => { const a=randomInt(2,9), ans=randomInt(2,9); return { q: {kk:`${a*ans} : ${a}`, ru:`${a*ans} : ${a}`}, ans }; } },
                { id: 'eq', kk: '–¢–µ“£–¥–µ—É', ru: '–£—Ä–∞–≤–Ω–µ–Ω–∏–µ', gen: () => { const x=randomInt(1,20); return { q: {kk:`x + 10 = ${x+10}`, ru:`x + 10 = ${x+10}`}, ans: x }; } }
            ],
            4: [
                { id: 'area', kk: '–ê—É–¥–∞–Ω', ru: '–ü–ª–æ—â–∞–¥—å', gen: () => { const a=randomInt(2,8), b=randomInt(2,5); return { q: {kk:`a=${a}, b=${b}. S=?`, ru:`a=${a}, b=${b}. S=?`}, ans: a*b }; } }
            ],
            5: [
                { id: 'perc', kk: '–ü–∞–π—ã–∑', ru: '–ü—Ä–æ—Ü–µ–Ω—Ç—ã', gen: () => { const n=randomInt(1,10)*20; return { q: {kk:`${n}-–¥—ñ“£ 50%-—ã?`, ru:`50% –æ—Ç ${n}?`}, ans: n/2 }; } }
            ],
            6: [
                { id: 'neg', kk: '–¢–µ—Ä—ñ—Å —Å–∞–Ω–¥–∞—Ä', ru: '–û—Ç—Ä–∏—Ü. —á–∏—Å–ª–∞', gen: () => { const a=randomInt(-10,5), b=randomInt(-5,10); return { q: {kk:`(${a}) + (${b})`, ru:`(${a}) + (${b})`}, ans: a+b }; } }
            ],
            7: [
                { id: 'alg', kk: '–ê–ª–≥–µ–±—Ä–∞', ru: '–ê–ª–≥–µ–±—Ä–∞', gen: () => { const x=randomInt(1,10); return { q: {kk:`4x = ${4*x}`, ru:`4x = ${4*x}`}, ans: x }; } }
            ],
            8: [
                { id: 'sqrt', kk: '–¢“Ø–±—ñ—Ä–ª–µ—Ä', ru: '–ö–æ—Ä–Ω–∏', gen: () => { const n=randomInt(2,15); return { q: {kk:`‚àö${n*n}`, ru:`‚àö${n*n}`}, ans: n }; } }
            ],
            9: [
                { id: 'prog', kk: '–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è', ru: '–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è', gen: () => { return { q: {kk:`a‚ÇÅ=2, d=3. a‚ÇÉ=?`, ru:`a‚ÇÅ=2, d=3. a‚ÇÉ=?`}, ans: 8 }; } }
            ]
        };

        const App = () => {
            const [lang, setLang] = useState('kk');
            const [user, setUser] = useState(localStorage.getItem('bilim_user') || '');
            const [tempName, setTempName] = useState('');
            const [grade, setGrade] = useState(1);
            const [topicId, setTopicId] = useState('all');
            const [problem, setProblem] = useState(null);
            const [answer, setAnswer] = useState('');
            const [isCorrect, setIsCorrect] = useState(null);
            const [leaders, setLeaders] = useState([]);
            const [showRank, setShowRank] = useState(false);

            useEffect(() => {
                const leadersRef = db.ref('users');
                leadersRef.on('value', (snap) => {
                    if (snap.exists()) {
                        const list = Object.values(snap.val()).sort((a, b) => b.score - a.score);
                        setLeaders(list);
                    }
                });
            }, []);

            const generate = (g = grade, tId = topicId) => {
                const topics = taskGenerators[g];
                let selected = tId === 'all' ? topics[randomInt(0, topics.length - 1)] : topics.find(x => x.id === tId);
                if (!selected) selected = topics[0];
                const data = selected.gen();
                setProblem({ ...data, topicName: {kk: selected.kk, ru: selected.ru} });
            };

            useEffect(() => { if(user) generate(grade, 'all'); setTopicId('all'); }, [grade, user]);

            const check = () => {
                if (!answer || isCorrect !== null) return;
                const correct = parseFloat(answer) === problem.ans;
                setIsCorrect(correct);
                if (correct) {
                    db.ref('users/' + user).transaction(d => {
                        if (d) { d.score += 10; return d; }
                        return { name: user, score: 10 };
                    });
                }
                setTimeout(() => { generate(); setAnswer(''); setIsCorrect(null); }, 1300);
            };

            const t = {
                kk: { welcome: "–ï—Å—ñ–º—ñ“£–¥—ñ –∂–∞–∑:", start: "–ë–∞—Å—Ç–∞—É", rank: "–†–ï–ô–¢–ò–ù–ì", score: "“∞–ø–∞–π", check: "–¢–ï–ö–°–ï–†–£", yes: "–î“∞–†–´–°!", no: "“ö–ê–¢–ï!", all: "–ë–ê–†–õ–´“í–´" },
                ru: { welcome: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è:", start: "–ù–∞—á–∞—Ç—å", rank: "–†–ï–ô–¢–ò–ù–ì", score: "–ë–∞–ª–ª—ã", check: "–ü–†–û–í–ï–†–ò–¢–¨", yes: "–í–ï–†–ù–û!", no: "–û–®–ò–ë–ö–ê!", all: "–í–°–ï –¢–ï–ú–´" }
            }[lang];

            if (!user) {
                return (
                    <div className="math-card bg-white w-full max-w-[400px] p-10">
                        <h1 className="text-3xl font-black text-[#5D5FEF] mb-6">BilimMath</h1>
                        <p className="text-gray-400 mb-4 text-sm font-bold uppercase tracking-widest">{t.welcome}</p>
                        <input value={tempName} onChange={e => setTempName(e.target.value)} className="w-full bg-gray-50 border-2 border-gray-100 rounded-2xl p-4 mb-4 outline-none focus:border-[#5D5FEF] font-bold text-lg" placeholder="..." />
                        <button onClick={() => { if(tempName.trim()){ setUser(tempName.trim()); localStorage.setItem('bilim_user', tempName.trim()); db.ref('users/'+tempName.trim()).once('value', s => { if(!s.exists()) db.ref('users/'+tempName.trim()).set({name: tempName.trim(), score: 0}); }); } }} className="w-full bg-[#5D5FEF] text-white py-4 rounded-2xl font-black shadow-lg"> {t.start} </button>
                    </div>
                );
            }

            if (showRank) {
                return (
                    <div className="math-card bg-white w-full max-w-[400px] p-8 h-[550px] flex flex-col">
                        <div className="flex justify-between items-center mb-6 text-gray-800">
                            <h2 className="text-2xl font-black italic">üèÜ {t.rank}</h2>
                            <button onClick={() => setShowRank(false)} className="text-[#5D5FEF] font-bold text-sm uppercase">–ù–∞–∑–∞–¥</button>
                        </div>
                        <div className="flex-1 overflow-y-auto no-scrollbar">
                            {leaders.map((p, i) => (
                                <div key={i} className={`flex justify-between items-center p-4 rounded-2xl mb-2 ${p.name === user ? 'bg-indigo-50 border border-indigo-100' : 'bg-gray-50'}`}>
                                    <div className="flex items-center gap-3">
                                        <span className={`w-8 h-8 flex items-center justify-center rounded-full font-black text-xs ${i === 0 ? 'rank-gold' : 'bg-gray-200'}`}>{i+1}</span>
                                        <span className="font-bold text-gray-700">{p.name}</span>
                                    </div>
                                    <span className="font-black text-[#5D5FEF]">{p.score}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            return (
                <div className="math-card bg-white w-full max-w-[480px] p-8">
                    <div className="flex justify-between items-center mb-8">
                        <div>
                            <h1 className="text-[#5D5FEF] text-xl font-black">BilimMath <span className="text-[10px] text-gray-300 ml-1">KZ</span></h1>
                            <p className="text-[10px] font-bold text-gray-400 uppercase tracking-tighter italic">{user}</p>
                        </div>
                        <div className="flex gap-2">
                             <button onClick={() => setShowRank(true)} className="bg-gray-50 px-3 py-2 rounded-xl text-[10px] font-black text-[#5D5FEF] border border-gray-100 uppercase tracking-widest">{t.rank}</button>
                             <div className="flex bg-gray-50 p-1 rounded-xl text-[10px] font-bold border border-gray-100">
                                <button onClick={() => setLang('kk')} className={`px-2 py-1 rounded-lg ${lang === 'kk' ? 'bg-white text-[#5D5FEF] shadow-sm' : 'text-gray-300'}`}>KK</button>
                                <button onClick={() => setLang('ru')} className={`px-2 py-1 rounded-lg ${lang === 'ru' ? 'bg-white text-[#5D5FEF] shadow-sm' : 'text-gray-300'}`}>RU</button>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-5 gap-2 mb-6">
                        {[1,2,3,4,5,6,7,8,9].map(g => (
                            <button key={g} onClick={() => setGrade(g)} className={`py-3 rounded-2xl font-black text-xs transition ${grade === g ? 'bg-[#5D5FEF] text-white shadow-lg' : 'bg-[#F2F6FF] text-[#5D5FEF]'}`}>{g}</button>
                        ))}
                    </div>

                    <div className="flex gap-2 overflow-x-auto no-scrollbar mb-6 pb-1">
                        <button onClick={() => {setTopicId('all'); generate(grade, 'all');}} className={`px-4 py-2 rounded-full text-[10px] font-black tracking-wider whitespace-nowrap transition ${topicId === 'all' ? 'bg-[#5D5FEF] text-white' : 'bg-gray-50 text-gray-400'}`}>{t.all}</button>
                        {taskGenerators[grade].map(topic => (
                            <button key={topic.id} onClick={() => {setTopicId(topic.id); generate(grade, topic.id);}} className={`px-4 py-2 rounded-full text-[10px] font-black tracking-wider whitespace-nowrap transition ${topicId === topic.id ? 'bg-[#5D5FEF] text-white' : 'bg-gray-50 text-gray-400'}`}>{topic[lang].toUpperCase()}</button>
                        ))}
                    </div>

                    <div className="bg-[#F9FBFF] rounded-[40px] p-10 text-center mb-6 border border-indigo-50/50">
                        <p className="text-[#A5B4FC] font-black tracking-[0.2em] text-[9px] mb-3 uppercase">{problem?.topicName[lang]}</p>
                        <h2 className="text-4xl font-black text-[#2D3142]">{problem?.q[lang]} = ?</h2>
                    </div>

                    <input type="number" inputMode="decimal" value={answer} onChange={e => setAnswer(e.target.value)} onKeyDown={e => e.key === 'Enter' && check()} className="w-full bg-[#F2F6FF] rounded-[24px] py-6 text-center text-4xl font-black text-[#5D5FEF] mb-6 outline-none border-4 border-transparent focus:border-indigo-100 transition-all placeholder:text-indigo-100" placeholder="?" />

                    <button onClick={check} disabled={isCorrect !== null} className={`w-full py-6 rounded-[24px] text-white font-black text-xl shadow-xl transition-all active:scale-95 ${isCorrect === true ? 'bg-green-500' : isCorrect === false ? 'bg-red-500' : 'bg-[#5D5FEF]'}`}>
                        {isCorrect === true ? t.yes : isCorrect === false ? t.no : t.check}
                    </button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

