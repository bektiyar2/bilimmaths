<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilimMath ‚Äî Global Multilingual</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/5341/5341426.png">
    <meta name="theme-color" content="#5D5FEF">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .math-card { box-shadow: 0 20px 60px rgba(93, 95, 239, 0.15); border-radius: 40px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .rank-gold { background: linear-gradient(45deg, #FFD700, #FFA500); color: white; }
    </style>
</head>
<body class="bg-[#F4F7FF] min-h-screen flex items-center justify-center p-4">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDYcopzuJzFYm2T0-GonGA4YQqpzz5egxw",
            authDomain: "bilimmath-a3e1e.firebaseapp.com",
            projectId: "bilimmath-a3e1e",
            storageBucket: "bilimmath-a3e1e.firebasestorage.app",
            messagingSenderId: "1016139764877",
            appId: "1:1016139764877:web:f9de05ef243efb41823ec4",
            databaseURL: "https://bilimmath-a3e1e-default-rtdb.europe-west1.firebasedatabase.app"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.database();

        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const taskGenerators = {
            1: [
                { id: 'add', kk: '“ö–æ—Å—É', ru: '–°–ª–æ–∂–µ–Ω–∏–µ', gen: () => { const a=randomInt(1,10), b=randomInt(1,10); return { q: {kk:`${a} + ${b}`, ru:`${a} + ${b}`}, ans: a+b }; } },
                { id: 'sub', kk: '–ê–∑–∞–π—Ç—É', ru: '–í—ã—á–∏—Ç–∞–Ω–∏–µ', gen: () => { const a=randomInt(5,15), b=randomInt(1,a); return { q: {kk:`${a} - ${b}`, ru:`${a} - ${b}`}, ans: a-b }; } },
                { id: 'compare', kk: '–°–∞–ª—ã—Å—Ç—ã—Ä—É', ru: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ', gen: () => { const a=randomInt(1,20), b=randomInt(1,20); const ans = a > b ? 1 : (a < b ? 2 : 3); return { q: {kk:`${a} –∂”ô–Ω–µ ${b}. “Æ–ª–∫–µ–Ω—ñ: 1-${a}, 2-${b}, 3-—Ç–µ“£`, ru:`${a} –∏ ${b}. –ë–æ–ª—å—à–µ: 1-${a}, 2-${b}, 3-—Ä–∞–≤–Ω—ã`}, ans }; } },
                { id: 'count', kk: '–°–∞–Ω–∞—É', ru: '–°—á—ë—Ç', gen: () => { const a=randomInt(1,5), b=randomInt(1,5); return { q: {kk:`${a} –∞–ª–º–∞ + ${b} –∞–ª–º–∞ =`, ru:`${a} —è–±–ª–æ–∫ + ${b} —è–±–ª–æ–∫ =`}, ans: a+b }; } },
                { id: 'shape', kk: '–§–∏–≥—É—Ä–∞–ª–∞—Ä', ru: '–§–∏–≥—É—Ä—ã', gen: () => { const shapes = [{kk:'“Ø—à–±“±—Ä—ã—à', ru:'—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫', ans:3}, {kk:'—Ç”©—Ä—Ç–±“±—Ä—ã—à', ru:'–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫', ans:4}, {kk:'–¥”©“£–≥–µ–ª–µ–∫', ru:'–∫—Ä—É–≥', ans:0}]; const s = shapes[randomInt(0,2)]; return { q: {kk:`${s.kk} –Ω–µ—à–µ –±“±—Ä—ã—à—Ç—ã?`, ru:`–°–∫–æ–ª—å–∫–æ —É–≥–ª–æ–≤ —É ${s.ru}?`}, ans: s.ans }; } },
            ],
            2: [
                { id: 'add2', kk: '“ö–æ—Å—É 100-–≥–µ –¥–µ–π—ñ–Ω', ru: '–°–ª–æ–∂–µ–Ω–∏–µ –¥–æ 100', gen: () => { const a=randomInt(10,50), b=randomInt(10,50); return { q: {kk:`${a} + ${b}`, ru:`${a} + ${b}`}, ans: a+b }; } },
                { id: 'sub2', kk: '–ê–∑–∞–π—Ç—É 100-–≥–µ –¥–µ–π—ñ–Ω', ru: '–í—ã—á–∏—Ç–∞–Ω–∏–µ –¥–æ 100', gen: () => { const a=randomInt(20,80), b=randomInt(10,a); return { q: {kk:`${a} - ${b}`, ru:`${a} - ${b}`}, ans: a-b }; } },
                { id: 'mult', kk: '–ö”©–±–µ–π—Ç—É –∫–µ—Å—Ç–µ—Å—ñ', ru: '–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è', gen: () => { const a=randomInt(2,5), b=randomInt(2,9); return { q: {kk:`${a} √ó ${b}`, ru:`${a} √ó ${b}`}, ans: a*b }; } },
                { id: 'div2', kk: '–ë”©–ª—É', ru: '–î–µ–ª–µ–Ω–∏–µ', gen: () => { const a=randomInt(2,5), ans=randomInt(2,9); return { q: {kk:`${a*ans} : ${a}`, ru:`${a*ans} : ${a}`}, ans }; } },
                { id: 'time', kk: '–£–∞“õ—ã—Ç', ru: '–í—Ä–µ–º—è', gen: () => { const h=randomInt(1,5); return { q: {kk:`${h} —Å–∞“ì–∞—Ç—Ç–∞ –Ω–µ—à–µ –º–∏–Ω—É—Ç?`, ru:`–°–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –≤ ${h} —á?`}, ans: h*60 }; } },
                { id: 'length', kk: '“∞–∑—ã–Ω–¥—ã“õ', ru: '–î–ª–∏–Ω–∞', gen: () => { const m=randomInt(1,5); return { q: {kk:`${m} –º = ? —Å–º`, ru:`${m} –º = ? —Å–º`}, ans: m*100 }; } },
                { id: 'weight', kk: '–°–∞–ª–º–∞“õ', ru: '–ú–∞—Å—Å–∞', gen: () => { const kg=randomInt(1,5); return { q: {kk:`${kg} –∫–≥ = ? –≥`, ru:`${kg} –∫–≥ = ? –≥`}, ans: kg*1000 }; } },
            ],
            3: [
                { id: 'mult3', kk: '–ö”©–±–µ–π—Ç—É', ru: '–£–º–Ω–æ–∂–µ–Ω–∏–µ', gen: () => { const a=randomInt(2,9), b=randomInt(2,9); return { q: {kk:`${a} √ó ${b}`, ru:`${a} √ó ${b}`}, ans: a*b }; } },
                { id: 'div', kk: '–ë”©–ª—É', ru: '–î–µ–ª–µ–Ω–∏–µ', gen: () => { const a=randomInt(2,9), ans=randomInt(2,9); return { q: {kk:`${a*ans} : ${a}`, ru:`${a*ans} : ${a}`}, ans }; } },
                { id: 'eq', kk: '–¢–µ“£–¥–µ—É', ru: '–£—Ä–∞–≤–Ω–µ–Ω–∏–µ', gen: () => { const x=randomInt(5,30); return { q: {kk:`x + 15 = ${x+15}`, ru:`x + 15 = ${x+15}`}, ans: x }; } },
                { id: 'perimeter', kk: '–ü–µ—Ä–∏–º–µ—Ç—Ä', ru: '–ü–µ—Ä–∏–º–µ—Ç—Ä', gen: () => { const a=randomInt(3,8), b=randomInt(3,8); return { q: {kk:`–¢—ñ–∫—Ç”©—Ä—Ç–±“±—Ä—ã—à: a=${a}, b=${b}. P=?`, ru:`–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫: a=${a}, b=${b}. P=?`}, ans: 2*(a+b) }; } },
                { id: 'order', kk: '–ê–º–∞–ª–¥–∞—Ä —Ä–µ—Ç—ñ', ru: '–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π', gen: () => { const a=randomInt(2,5), b=randomInt(2,5), c=randomInt(1,5); return { q: {kk:`${a} √ó ${b} + ${c}`, ru:`${a} √ó ${b} + ${c}`}, ans: a*b+c }; } },
                { id: 'compare3', kk: '–°–∞–ª—ã—Å—Ç—ã—Ä—É', ru: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ', gen: () => { const a=randomInt(100,500), b=randomInt(100,500); const ans = a > b ? 1 : (a < b ? 2 : 3); return { q: {kk:`${a} –∂”ô–Ω–µ ${b}. “Æ–ª–∫–µ–Ω—ñ: 1-${a}, 2-${b}, 3-—Ç–µ“£`, ru:`${a} –∏ ${b}. –ë–æ–ª—å—à–µ: 1-${a}, 2-${b}, 3-—Ä–∞–≤–Ω—ã`}, ans }; } },
                { id: 'round', kk: '–î”©“£–≥–µ–ª–µ–∫—Ç–µ—É', ru: '–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ', gen: () => { const n=randomInt(15,95); const ans=Math.round(n/10)*10; return { q: {kk:`${n} ‚âà ? (–æ–Ω–¥—ã“õ“õ–∞)`, ru:`${n} ‚âà ? (–¥–æ –¥–µ—Å—è—Ç–∫–æ–≤)`}, ans }; } },
            ],
            4: [
                { id: 'mult4', kk: '–ö”©–ø —Ç–∞“£–±–∞–ª—ã –∫”©–±–µ–π—Ç—É', ru: '–ú–Ω–æ–≥–æ–∑–Ω–∞—á–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ', gen: () => { const a=randomInt(10,30), b=randomInt(2,9); return { q: {kk:`${a} √ó ${b}`, ru:`${a} √ó ${b}`}, ans: a*b }; } },
                { id: 'div4', kk: '–ö”©–ø —Ç–∞“£–±–∞–ª—ã –±”©–ª—É', ru: '–ú–Ω–æ–≥–æ–∑–Ω–∞—á–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ', gen: () => { const a=randomInt(2,9), ans=randomInt(10,30); return { q: {kk:`${a*ans} : ${a}`, ru:`${a*ans} : ${a}`}, ans }; } },
                { id: 'area', kk: '–ê—É–¥–∞–Ω', ru: '–ü–ª–æ—â–∞–¥—å', gen: () => { const a=randomInt(3,12), b=randomInt(3,12); return { q: {kk:`–¢—ñ–∫—Ç”©—Ä—Ç–±“±—Ä—ã—à: a=${a}, b=${b}. S=?`, ru:`–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫: a=${a}, b=${b}. S=?`}, ans: a*b }; } },
                { id: 'fraction', kk: '–ë”©–ª—à–µ–∫—Ç–µ—Ä', ru: '–î—Ä–æ–±–∏', gen: () => { const n=randomInt(2,8); return { q: {kk:`${n}/2 + ${n}/2`, ru:`${n}/2 + ${n}/2`}, ans: n }; } },
                { id: 'speed', kk: '–ñ—ã–ª–¥–∞–º–¥—ã“õ', ru: '–°–∫–æ—Ä–æ—Å—Ç—å', gen: () => { const v=randomInt(40,80), t=randomInt(2,5); return { q: {kk:`v=${v} –∫–º/—Å–∞“ì, t=${t} —Å–∞“ì. S=?`, ru:`v=${v} –∫–º/—á, t=${t} —á. S=?`}, ans: v*t }; } },
                { id: 'scale', kk: '–ú–∞—Å—à—Ç–∞–±', ru: '–ú–∞—Å—à—Ç–∞–±', gen: () => { const real=randomInt(10,50); return { q: {kk:`–ú–∞—Å—à—Ç–∞–± 1:10. –ö–∞—Ä—Ç–∞–¥–∞ ${real} —Å–º. –®—ã–Ω–¥—ã“ì—ã–Ω–¥–∞=? –º`, ru:`–ú–∞—Å—à—Ç–∞–± 1:10. –ù–∞ –∫–∞—Ä—Ç–µ ${real} —Å–º. –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏=? –º`}, ans: real }; } },
                { id: 'volume', kk: '–ö”©–ª–µ–º', ru: '–û–±—ä—ë–º', gen: () => { const a=randomInt(2,5), b=randomInt(2,5), c=randomInt(2,5); return { q: {kk:`–ü–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥: ${a}√ó${b}√ó${c}. V=?`, ru:`–ü–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥: ${a}√ó${b}√ó${c}. V=?`}, ans: a*b*c }; } },
            ],
            5: [
                { id: 'decimal', kk: '–û–Ω–¥—ã“õ –±”©–ª—à–µ–∫—Ç–µ—Ä', ru: '–î–µ—Å—è—Ç–∏—á–Ω—ã–µ –¥—Ä–æ–±–∏', gen: () => { const a=randomInt(1,9), b=randomInt(1,9); return { q: {kk:`${a}.5 + ${b}.5`, ru:`${a}.5 + ${b}.5`}, ans: a+b+1 }; } },
                { id: 'perc', kk: '–ü–∞–π—ã–∑', ru: '–ü—Ä–æ—Ü–µ–Ω—Ç—ã', gen: () => { const n=randomInt(2,10)*20; return { q: {kk:`${n}-–¥—ñ“£ 50%-—ã?`, ru:`50% –æ—Ç ${n}?`}, ans: n/2 }; } },
                { id: 'average', kk: '–û—Ä—Ç–∞—à–∞ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞–ª—ã“õ', ru: '–°—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ', gen: () => { const a=randomInt(10,30), b=randomInt(10,30); return { q: {kk:`${a} –∂”ô–Ω–µ ${b} –æ—Ä—Ç–∞—à–∞ –º”ô–Ω—ñ`, ru:`–°—Ä–µ–¥–Ω–µ–µ ${a} –∏ ${b}`}, ans: Math.round((a+b)/2) }; } },
                { id: 'angle', kk: '–ë“±—Ä—ã—à—Ç–∞—Ä', ru: '–£–≥–ª—ã', gen: () => { const a=randomInt(30,150); return { q: {kk:`180¬∞ - ${a}¬∞ = ?`, ru:`180¬∞ - ${a}¬∞ = ?`}, ans: 180-a }; } },
                { id: 'circle', kk: '–®–µ“£–±–µ—Ä', ru: '–û–∫—Ä—É–∂–Ω–æ—Å—Ç—å', gen: () => { const r=randomInt(2,10); return { q: {kk:`r=${r}. –î–∏–∞–º–µ—Ç—Ä d=?`, ru:`r=${r}. –î–∏–∞–º–µ—Ç—Ä d=?`}, ans: r*2 }; } },
                { id: 'triangle', kk: '“Æ—à–±“±—Ä—ã—à –∞—É–¥–∞–Ω—ã', ru: '–ü–ª–æ—â–∞–¥—å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞', gen: () => { const a=randomInt(4,12), h=randomInt(3,10); return { q: {kk:`a=${a}, h=${h}. S=a√óh:2=?`, ru:`a=${a}, h=${h}. S=a√óh:2=?`}, ans: Math.round(a*h/2) }; } },
                { id: 'proportion', kk: '–ü—Ä–æ–ø–æ—Ä—Ü–∏—è', ru: '–ü—Ä–æ–ø–æ—Ä—Ü–∏—è', gen: () => { const a=randomInt(2,6), b=randomInt(2,6); return { q: {kk:`${a}:2 = x:${b*2}. x=?`, ru:`${a}:2 = x:${b*2}. x=?`}, ans: a*b }; } },
            ],
            6: [
                { id: 'neg', kk: '–¢–µ—Ä—ñ—Å —Å–∞–Ω–¥–∞—Ä', ru: '–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞', gen: () => { const a=randomInt(-15,10), b=randomInt(-10,15); return { q: {kk:`${a} + ${b}`, ru:`${a} + ${b}`}, ans: a+b }; } },
                { id: 'negmult', kk: '–¢–µ—Ä—ñ—Å —Å–∞–Ω–¥–∞—Ä–¥—ã –∫”©–±–µ–π—Ç—É', ru: '–£–º–Ω–æ–∂–µ–Ω–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö', gen: () => { let a=randomInt(-5,5), b=randomInt(2,5); if(a===0) a=randomInt(1,5); return { q: {kk:`${a} √ó ${b}`, ru:`${a} √ó ${b}`}, ans: a*b }; } },
                { id: 'coord', kk: '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–ª–∞—Ä', ru: '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã', gen: () => { const x=randomInt(-5,5), y=randomInt(-5,5); return { q: {kk:`A(${x};${y}). x –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Å—ã?`, ru:`A(${x};${y}). –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ x?`}, ans: x }; } },
                { id: 'module', kk: '–ú–æ–¥—É–ª—å', ru: '–ú–æ–¥—É–ª—å', gen: () => { const a=randomInt(-10,10); return { q: {kk:`|${a}| = ?`, ru:`|${a}| = ?`}, ans: Math.abs(a) }; } },
                { id: 'ratio', kk: '“ö–∞—Ç—ã–Ω–∞—Å', ru: '–û—Ç–Ω–æ—à–µ–Ω–∏–µ', gen: () => { const a=randomInt(10,30), b=randomInt(2,5); return { q: {kk:`${a*b}:${b} = ?`, ru:`${a*b}:${b} = ?`}, ans: a }; } },
                { id: 'percent2', kk: '–ü–∞–π—ã–∑–¥–∞—Ä', ru: '–ü—Ä–æ—Ü–µ–Ω—Ç—ã', gen: () => { const n=randomInt(20,80); return { q: {kk:`200-–¥—ñ“£ ${n}%-—ã?`, ru:`${n}% –æ—Ç 200?`}, ans: Math.round(200*n/100) }; } },
                { id: 'equation2', kk: '–¢–µ“£–¥–µ—É', ru: '–£—Ä–∞–≤–Ω–µ–Ω–∏–µ', gen: () => { const x=randomInt(5,25); return { q: {kk:`3x - 5 = ${3*x-5}. x=?`, ru:`3x - 5 = ${3*x-5}. x=?`}, ans: x }; } },
            ],
            7: [
                { id: 'alg', kk: '–ê–ª–≥–µ–±—Ä–∞–ª—ã“õ ”©—Ä–Ω–µ–∫—Ç–µ—Ä', ru: '–ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è', gen: () => { const x=randomInt(2,10); return { q: {kk:`2x + 3x = ${5*x}. x=?`, ru:`2x + 3x = ${5*x}. x=?`}, ans: x }; } },
                { id: 'linear', kk: '–°—ã–∑—ã“õ—Ç—ã“õ —Ç–µ“£–¥–µ—É', ru: '–õ–∏–Ω–µ–π–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ', gen: () => { const x=randomInt(3,15); return { q: {kk:`5x - 10 = ${5*x-10}. x=?`, ru:`5x - 10 = ${5*x-10}. x=?`}, ans: x }; } },
                { id: 'system', kk: '–¢–µ“£–¥–µ—É–ª–µ—Ä –∂“Ø–π–µ—Å—ñ', ru: '–°–∏—Å—Ç–µ–º–∞ —É—Ä–∞–≤–Ω–µ–Ω–∏–π', gen: () => { const x=randomInt(2,8); return { q: {kk:`x + y = 10, x = ${x}. y=?`, ru:`x + y = 10, x = ${x}. y=?`}, ans: 10-x }; } },
                { id: 'degree', kk: '–î”ô—Ä–µ–∂–µ', ru: '–°—Ç–µ–ø–µ–Ω—å', gen: () => { const a=randomInt(2,5), n=randomInt(2,4); return { q: {kk:`${a}^${n} = ?`, ru:`${a}^${n} = ?`}, ans: Math.pow(a,n) }; } },
                { id: 'formula', kk: '–§–æ—Ä–º—É–ª–∞–ª–∞—Ä', ru: '–§–æ—Ä–º—É–ª—ã', gen: () => { const a=randomInt(5,15), b=randomInt(5,15); return { q: {kk:`(a+b)¬≤ “õ–∞—à–∞–Ω a=${a}, b=${b}?`, ru:`(a+b)¬≤ –ø—Ä–∏ a=${a}, b=${b}?`}, ans: Math.pow(a+b,2) }; } },
                { id: 'function', kk: '–§—É–Ω–∫—Ü–∏—è', ru: '–§—É–Ω–∫—Ü–∏—è', gen: () => { const x=randomInt(1,10); return { q: {kk:`y = 2x + 1. x=${x}, y=?`, ru:`y = 2x + 1. x=${x}, y=?`}, ans: 2*x+1 }; } },
                { id: 'proportion2', kk: '–ü—Ä–æ–ø–æ—Ä—Ü–∏—è', ru: '–ü—Ä–æ–ø–æ—Ä—Ü–∏—è', gen: () => { const a=randomInt(3,9), b=randomInt(2,6); return { q: {kk:`${a}/${b} = x/${b*2}. x=?`, ru:`${a}/${b} = x/${b*2}. x=?`}, ans: a*2 }; } },
            ],
            8: [
                { id: 'quadratic', kk: '–ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É', ru: '–ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ', gen: () => { const x=randomInt(2,6); return { q: {kk:`x¬≤ = ${x*x}. x=?`, ru:`x¬≤ = ${x*x}. x=?`}, ans: x }; } },
                { id: 'sqrt', kk: '–¢“Ø–±—ñ—Ä–ª–µ—Ä', ru: '–ö–æ—Ä–Ω–∏', gen: () => { const n=randomInt(2,15); return { q: {kk:`‚àö${n*n} = ?`, ru:`‚àö${n*n} = ?`}, ans: n }; } },
                { id: 'fraction8', kk: '–ê–ª–≥–µ–±—Ä–∞–ª—ã“õ –±”©–ª—à–µ–∫—Ç–µ—Ä', ru: '–ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –¥—Ä–æ–±–∏', gen: () => { const x=randomInt(3,12); return { q: {kk:`x/2 + x/2 = ${x}. x=?`, ru:`x/2 + x/2 = ${x}. x=?`}, ans: x }; } },
                { id: 'inequality', kk: '–¢–µ“£—Å—ñ–∑–¥—ñ–∫—Ç–µ—Ä', ru: '–ù–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞', gen: () => { const x=randomInt(5,20); return { q: {kk:`x > ${x-1}. –ï“£ –∫—ñ—à—ñ –±“Ø—Ç—ñ–Ω x=?`, ru:`x > ${x-1}. –ù–∞–∏–º–µ–Ω—å—à–µ–µ —Ü–µ–ª–æ–µ x=?`}, ans: x }; } },
                { id: 'pythagoras', kk: '–ü–∏—Ñ–∞–≥–æ—Ä —Ç–µ–æ—Ä–µ–º–∞—Å—ã', ru: '–¢–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞', gen: () => { const a=3, b=4; return { q: {kk:`a=${a}, b=${b}. c¬≤=a¬≤+b¬≤. c=?`, ru:`a=${a}, b=${b}. c¬≤=a¬≤+b¬≤. c=?`}, ans: 5 }; } },
                { id: 'circle8', kk: '–®–µ“£–±–µ—Ä –∞—É–¥–∞–Ω—ã', ru: '–ü–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞', gen: () => { const r=randomInt(2,8); return { q: {kk:`r=${r}. S‚âàœÄr¬≤‚âà3r¬≤. S‚âà?`, ru:`r=${r}. S‚âàœÄr¬≤‚âà3r¬≤. S‚âà?`}, ans: Math.round(3*r*r) }; } },
                { id: 'similar', kk: '“∞“õ—Å–∞—Å “Ø—à–±“±—Ä—ã—à—Ç–∞—Ä', ru: '–ü–æ–¥–æ–±–Ω—ã–µ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏', gen: () => { const a=randomInt(2,8), k=randomInt(2,4); return { q: {kk:`a=${a}, k=${k}. a'=a√ók=?`, ru:`a=${a}, k=${k}. a'=a√ók=?`}, ans: a*k }; } },
            ],
            9: [
                { id: 'quad9', kk: '–ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É', ru: '–ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ', gen: () => { const x=randomInt(2,8); const b=-(2*x), c=x*x; return { q: {kk:`x¬≤ + ${b}x + ${c} = 0. x‚ÇÅ=?`, ru:`x¬≤ + ${b}x + ${c} = 0. x‚ÇÅ=?`}, ans: x }; } },
                { id: 'prog', kk: '–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞–ª—ã“õ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è', ru: '–ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è', gen: () => { const a1=randomInt(2,8), d=randomInt(2,5); return { q: {kk:`a‚ÇÅ=${a1}, d=${d}. a‚ÇÉ=a‚ÇÅ+2d=?`, ru:`a‚ÇÅ=${a1}, d=${d}. a‚ÇÉ=a‚ÇÅ+2d=?`}, ans: a1+2*d }; } },
                { id: 'geomprog', kk: '–ì–µ–æ–º–µ—Ç—Ä–∏—è–ª—ã“õ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è', ru: '–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è', gen: () => { const b1=randomInt(2,5), q=2; return { q: {kk:`b‚ÇÅ=${b1}, q=2. b‚ÇÉ=b‚ÇÅ√óq¬≤=?`, ru:`b‚ÇÅ=${b1}, q=2. b‚ÇÉ=b‚ÇÅ√óq¬≤=?`}, ans: b1*4 }; } },
                { id: 'trig', kk: '–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è', ru: '–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è', gen: () => { return { q: {kk:`sin 30¬∞ = ?`, ru:`sin 30¬∞ = ?`}, ans: 0.5 }; } },
                { id: 'vectors', kk: '–í–µ–∫—Ç–æ—Ä–ª–∞—Ä', ru: '–í–µ–∫—Ç–æ—Ä—ã', gen: () => { const x=randomInt(2,8), y=randomInt(2,8); return { q: {kk:`a‚Éó(${x};${y}). –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ x=?`, ru:`a‚Éó(${x};${y}). –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ x=?`}, ans: x }; } },
                { id: 'combinatorics', kk: '–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞', ru: '–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞', gen: () => { const n=randomInt(3,6); return { q: {kk:`–ù–µ—à–µ —Ç”ô—Å—ñ–ª–º–µ–Ω ${n} –∞–¥–∞–º–¥—ã “õ–∞—Ç–∞—Ä“ì–∞ “õ–æ—é? ${n}!=?`, ru:`–°–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å ${n} —á–µ–ª–æ–≤–µ–∫? ${n}!=?`}, ans: n===3?6:n===4?24:n===5?120:720 }; } },
                { id: 'probability', kk: '–´“õ—Ç–∏–º–∞–ª–¥—ã“õ', ru: '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å', gen: () => { const n=randomInt(2,5); return { q: {kk:`–ú–æ–Ω–µ—Ç–∞–Ω—ã ${n} —Ä–µ—Ç –ª–∞“õ—Ç—ã—Ä—É. –ë–∞—Ä–ª—ã“õ –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä: 2^${n}=?`, ru:`–ü–æ–¥–±—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç—É ${n} —Ä–∞–∑. –í—Å–µ–≥–æ –∏—Å—Ö–æ–¥–æ–≤: 2^${n}=?`}, ans: Math.pow(2,n) }; } },
            ],
        };

        const App = () => {
            const [lang, setLang] = useState('kk');
            const [user, setUser] = useState(localStorage.getItem('bilim_user') || '');
            const [tempName, setTempName] = useState('');
            const [grade, setGrade] = useState(1);
            const [topicId, setTopicId] = useState('all');
            const [problem, setProblem] = useState(null);
            const [answer, setAnswer] = useState('');
            const [isCorrect, setIsCorrect] = useState(null);
            const [leaders, setLeaders] = useState([]);
            const [showRank, setShowRank] = useState(false);
            const inputRef = useRef(null);

            useEffect(() => {
                const leadersRef = db.ref('users');
                leadersRef.on('value', (snap) => {
                    if (snap.exists()) {
                        const list = Object.values(snap.val()).sort((a, b) => b.score - a.score);
                        setLeaders(list);
                    }
                });
            }, []);

            const generate = (g = grade, tId = topicId) => {
                const topics = taskGenerators[g];
                let selected = tId === 'all' ? topics[randomInt(0, topics.length - 1)] : topics.find(x => x.id === tId);
                if (!selected) selected = topics[0];
                const data = selected.gen();
                setProblem({ ...data, topicName: {kk: selected.kk, ru: selected.ru} });
                setTimeout(() => inputRef.current?.focus(), 100);
            };

            useEffect(() => { if(user) generate(grade, 'all'); setTopicId('all'); }, [grade, user]);

            const check = () => {
                if (!answer || isCorrect !== null) return;
                const correct = parseFloat(answer) === problem.ans;
                setIsCorrect(correct);
                if (correct) {
                    db.ref('users/' + user).transaction(d => {
                        if (d) { d.score += 10; return d; }
                        return { name: user, score: 10 };
                    });
                }
                setTimeout(() => { generate(); setAnswer(''); setIsCorrect(null); }, 1300);
            };

            const t = {
                kk: { welcome: "–ï—Å—ñ–º—ñ“£–¥—ñ –∂–∞–∑:", start: "–ë–∞—Å—Ç–∞—É", rank: "–†–ï–ô–¢–ò–ù–ì", score: "“∞–ø–∞–π", check: "–¢–ï–ö–°–ï–†–£", yes: "–î“∞–†–´–°!", no: "“ö–ê–¢–ï!", all: "–ë–ê–†–õ–´“í–´" },
                ru: { welcome: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è:", start: "–ù–∞—á–∞—Ç—å", rank: "–†–ï–ô–¢–ò–ù–ì", score: "–ë–∞–ª–ª—ã", check: "–ü–†–û–í–ï–†–ò–¢–¨", yes: "–í–ï–†–ù–û!", no: "–û–®–ò–ë–ö–ê!", all: "–í–°–ï –¢–ï–ú–´" }
            }[lang];

            if (!user) {
                return (
                    <div className="math-card bg-white w-full max-w-[400px] p-10">
                        <h1 className="text-3xl font-black text-[#5D5FEF] mb-6">BilimMath</h1>
                        <p className="text-gray-400 mb-4 text-sm font-bold uppercase tracking-widest">{t.welcome}</p>
                        <input value={tempName} onChange={e => setTempName(e.target.value)} className="w-full bg-gray-50 border-2 border-gray-100 rounded-2xl p-4 mb-4 outline-none focus:border-[#5D5FEF] font-bold text-lg" placeholder="..." />
                        <button onClick={() => { if(tempName.trim()){ setUser(tempName.trim()); localStorage.setItem('bilim_user', tempName.trim()); db.ref('users/'+tempName.trim()).once('value', s => { if(!s.exists()) db.ref('users/'+tempName.trim()).set({name: tempName.trim(), score: 0}); }); } }} className="w-full bg-[#5D5FEF] text-white py-4 rounded-2xl font-black shadow-lg"> {t.start} </button>
                    </div>
                );
            }

            if (showRank) {
                return (
                    <div className="math-card bg-white w-full max-w-[400px] p-8 h-[550px] flex flex-col">
                        <div className="flex justify-between items-center mb-6 text-gray-800">
                            <h2 className="text-2xl font-black italic">üèÜ {t.rank}</h2>
                            <button onClick={() => setShowRank(false)} className="text-[#5D5FEF] font-bold text-sm uppercase">–ù–∞–∑–∞–¥</button>
                        </div>
                        <div className="flex-1 overflow-y-auto no-scrollbar">
                            {leaders.map((p, i) => (
                                <div key={i} className={`flex justify-between items-center p-4 rounded-2xl mb-2 ${p.name === user ? 'bg-indigo-50 border border-indigo-100' : 'bg-gray-50'}`}>
                                    <div className="flex items-center gap-3">
                                        <span className={`w-8 h-8 flex items-center justify-center rounded-full font-black text-xs ${i === 0 ? 'rank-gold' : 'bg-gray-200'}`}>{i+1}</span>
                                        <span className="font-bold text-gray-700">{p.name}</span>
                                    </div>
                                    <span className="font-black text-[#5D5FEF]">{p.score}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            return (
                <div className="math-card bg-white w-full max-w-[480px] p-8">
                    <div className="flex justify-between items-center mb-8">
                        <div>
                            <h1 className="text-[#5D5FEF] text-xl font-black">BilimMath <span className="text-[10px] text-gray-300 ml-1">KZ</span></h1>
                            <p className="text-[10px] font-bold text-gray-400 uppercase tracking-tighter italic">{user}</p>
                        </div>
                        <div className="flex gap-2">
                             <button onClick={() => setShowRank(true)} className="bg-gray-50 px-3 py-2 rounded-xl text-[10px] font-black text-[#5D5FEF] border border-gray-100 uppercase tracking-widest">{t.rank}</button>
                             <div className="flex bg-gray-50 p-1 rounded-xl text-[10px] font-bold border border-gray-100">
                                <button onClick={() => setLang('kk')} className={`px-2 py-1 rounded-lg ${lang === 'kk' ? 'bg-white text-[#5D5FEF] shadow-sm' : 'text-gray-300'}`}>KK</button>
                                <button onClick={() => setLang('ru')} className={`px-2 py-1 rounded-lg ${lang === 'ru' ? 'bg-white text-[#5D5FEF] shadow-sm' : 'text-gray-300'}`}>RU</button>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-5 gap-2 mb-6">
                        {[1,2,3,4,5,6,7,8,9].map(g => (
                            <button key={g} onClick={() => setGrade(g)} className={`py-3 rounded-2xl font-black text-xs transition ${grade === g ? 'bg-[#5D5FEF] text-white shadow-lg' : 'bg-[#F2F6FF] text-[#5D5FEF]'}`}>{g}</button>
                        ))}
                    </div>

                    <div className="grid grid-cols-2 gap-2 mb-6" style={{maxHeight: '200px', overflowY: 'auto'}}>
                        <button onClick={() => {setTopicId('all'); generate(grade, 'all');}} className={`px-4 py-3 rounded-2xl text-[10px] font-black tracking-wider transition ${topicId === 'all' ? 'bg-[#5D5FEF] text-white' : 'bg-gray-50 text-gray-400'}`}>{t.all}</button>
                        {taskGenerators[grade].map(topic => (
                            <button key={topic.id} onClick={() => {setTopicId(topic.id); generate(grade, topic.id);}} className={`px-4 py-3 rounded-2xl text-[10px] font-black tracking-wider transition ${topicId === topic.id ? 'bg-[#5D5FEF] text-white' : 'bg-gray-50 text-gray-400'}`}>{topic[lang].toUpperCase()}</button>
                        ))}
                    </div>

                    <div className="bg-[#F9FBFF] rounded-[40px] p-10 text-center mb-6 border border-indigo-50/50">
                        <p className="text-[#A5B4FC] font-black tracking-[0.2em] text-[9px] mb-3 uppercase">{problem?.topicName[lang]}</p>
                        <h2 className="text-4xl font-black text-[#2D3142]">{problem?.q[lang]} = ?</h2>
                    </div>

                    <input ref={inputRef} type="number" inputMode="decimal" value={answer} onChange={e => setAnswer(e.target.value)} onKeyDown={e => e.key === 'Enter' && check()} className="w-full bg-[#F2F6FF] rounded-[24px] py-6 text-center text-4xl font-black text-[#5D5FEF] mb-6 outline-none border-4 border-transparent focus:border-indigo-100 transition-all placeholder:text-indigo-100" placeholder="?" />

                    <button onClick={check} disabled={isCorrect !== null} className={`w-full py-6 rounded-[24px] text-white font-black text-xl shadow-xl transition-all active:scale-95 ${isCorrect === true ? 'bg-green-500' : isCorrect === false ? 'bg-red-500' : 'bg-[#5D5FEF]'}`}>
                        {isCorrect === true ? t.yes : isCorrect === false ? t.no : t.check}
                    </button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error:', err));
            });
        }
    </script>
</body>
</html>
