<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilimMath — Тренажер</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .math-card { box-shadow: 0 20px 50px rgba(93, 95, 239, 0.1); border-radius: 40px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-[#F8FAFF] min-h-screen flex items-center justify-center p-4">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        // --- ГЕНЕРАТОРЫ ЗАДАЧ ПО ТЕМАМ ---
        const taskGenerators = {
            1: {
                "Қосу/Сложение": () => { const a = randomInt(1, 10), b = randomInt(1, 10); return { q: `${a} + ${b} = ?`, ans: a + b }; },
                "Азайту/Вычитание": () => { const a = randomInt(5, 20), b = randomInt(1, a); return { q: `${a} - ${b} = ?`, ans: a - b }; }
            },
            2: {
                "Көбейту/Умножение": () => { const a = randomInt(2, 9), b = randomInt(2, 9); return { q: `${a} × ${b} = ?`, ans: a * b }; },
                "Бөлу/Деление": () => { const ans = randomInt(2, 9), b = randomInt(2, 9); return { q: `${ans * b} : ${b} = ?`, ans }; }
            },
            3: {
                "Теңдеулер/Уравнения": () => { const x = randomInt(5, 50), a = randomInt(10, 30); return { q: `x + ${a} = ${x + a}. x = ?`, ans: x }; }
            },
            4: {
                "Периметр": () => { const a = randomInt(2, 10), b = randomInt(2, 10); return { q: `a=${a}, b=${b}. P=?`, ans: 2 * (a + b) }; },
                "Аудан/Площадь": () => { const a = randomInt(2, 10), b = randomInt(2, 10); return { q: `a=${a}, b=${b}. S=?`, ans: a * b }; }
            },
            5: {
                "Пайыздар/Проценты": () => { const w = randomInt(10, 10)*10, p = randomInt(1, 5)*10; return { q: `${w}-дің ${p}%-ы?`, ans: w * p / 100 }; },
                "Бөлшектер/Дроби": () => { const a = randomInt(1, 9)/10, b = randomInt(1, 9)/10; return { q: `${a} + ${b} = ?`, ans: Math.round((a+b)*10)/10 }; }
            },
            6: {
                "Теріс сандар/Отриц. числа": () => { const a = randomInt(-15, 5), b = randomInt(-5, 15); return { q: `(${a}) + (${b}) = ?`, ans: a + b }; }
            },
            7: {
                "Алгебра": () => { const x = randomInt(1, 10), a = randomInt(2, 5), b = randomInt(1, 15); return { q: `${a}x + ${b} = ${a*x + b}. x=?`, ans: x }; }
            },
            8: {
                "Түбірлер/Корни": () => { const n = randomInt(2, 15); return { q: `√${n * n} = ?`, ans: n }; },
                "Квадрат теңдеулер/Квадр. уравнения": () => { const x1 = randomInt(1, 5), x2 = randomInt(1, 5); return { q: `x² ${-(x1+x2)>=0?'+':''} ${-(x1+x2)}x + ${x1*x2} = 0. Кіші түбірі?`, ans: Math.min(x1, x2) }; }
            },
            9: {
                "Прогрессия": () => { const a1 = randomInt(1, 10), d = randomInt(2, 5); return { q: `a₁=${a1}, d=${d}. a₃=?`, ans: a1 + 2*d }; }
            }
        };

        const App = () => {
            const [lang, setLang] = useState('kk');
            const [grade, setGrade] = useState(1);
            const [topic, setTopic] = useState('all');
            const [problem, setProblem] = useState(null);
            const [answer, setAnswer] = useState('');
            const [isCorrect, setIsCorrect] = useState(null);
            const [stats, setStats] = useState(() => {
                const s = localStorage.getItem('bilim_stats');
                return s ? JSON.parse(s) : { c: 0, t: 0 };
            });

            const currentTopics = Object.keys(taskGenerators[grade]);

            const generate = (g = grade, t = topic) => {
                const targetTopic = t === 'all' ? currentTopics[randomInt(0, currentTopics.length - 1)] : t;
                const gen = taskGenerators[g][targetTopic]();
                setProblem({ ...gen, displayTopic: targetTopic.split('/')[lang === 'kk' ? 0 : 1] });
            };

            useEffect(() => { generate(grade, 'all'); setTopic('all'); }, [grade, lang]);
            useEffect(() => { localStorage.setItem('bilim_stats', JSON.stringify(stats)); }, [stats]);

            const check = () => {
                if (!answer) return;
                const correct = parseFloat(answer) === problem.ans;
                setIsCorrect(correct);
                setStats(s => ({ c: correct ? s.c + 1 : s.c, t: s.t + 1 }));
                setTimeout(() => { generate(); setAnswer(''); setIsCorrect(null); }, 1200);
            };

            const t = {
                kk: { score: "Ұпай", check: "Тексеру", all: "Барлығы", ok: "Дұрыс!", no: "Қате!" },
                ru: { score: "Счёт", check: "Проверить", all: "Все темы", ok: "Верно!", no: "Ошибка!" }
            }[lang];

            if (!problem) return null;

            return (
                <div className="math-card bg-white w-full max-w-[480px] p-6 md:p-10 border border-indigo-50">
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-[#5D5FEF] text-2xl font-black italic">BilimMath</h1>
                        <div className="flex bg-gray-100 p-1 rounded-xl text-[10px] font-bold">
                            <button onClick={() => setLang('kk')} className={`px-3 py-1.5 rounded-lg ${lang === 'kk' ? 'bg-white text-[#5D5FEF] shadow-sm' : 'text-gray-400'}`}>ҚАЗ</button>
                            <button onClick={() => setLang('ru')} className={`px-3 py-1.5 rounded-lg ${lang === 'ru' ? 'bg-white text-[#5D5FEF] shadow-sm' : 'text-gray-400'}`}>РУС</button>
                        </div>
                    </div>

                    <div className="grid grid-cols-5 gap-2 mb-6">
                        {[1,2,3,4,5,6,7,8,9].map(g => (
                            <button key={g} onClick={() => setGrade(g)} className={`py-2.5 rounded-xl font-bold text-sm transition ${grade === g ? 'bg-[#5D5FEF] text-white shadow-lg shadow-indigo-200' : 'bg-[#F2F6FF] text-[#5D5FEF]'}`}>{g}</button>
                        ))}
                    </div>

                    <div className="flex gap-2 overflow-x-auto no-scrollbar mb-6 pb-2">
                        <button onClick={() => {setTopic('all'); generate(grade, 'all');}} className={`px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-wider whitespace-nowrap ${topic === 'all' ? 'bg-[#5D5FEF] text-white' : 'bg-gray-50 text-gray-400 border border-gray-100'}`}>{t.all}</button>
                        {currentTopics.map(top => (
                            <button key={top} onClick={() => {setTopic(top); generate(grade, top);}} className={`px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-wider whitespace-nowrap ${topic === top ? 'bg-[#5D5FEF] text-white' : 'bg-gray-50 text-gray-400 border border-gray-100'}`}>{top.split('/')[lang === 'kk' ? 0 : 1]}</button>
                        ))}
                    </div>

                    <div className="bg-[#F8FAFF] rounded-[32px] p-10 text-center mb-6 border border-indigo-50/50 relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1 bg-indigo-100 opacity-20"></div>
                        <p className="text-[#A5B4FC] font-black tracking-[0.2em] text-[10px] mb-3 uppercase">{problem.displayTopic}</p>
                        <h2 className="text-4xl md:text-5xl font-black text-[#2D3142]">{problem.q}</h2>
                    </div>

                    <input type="number" inputMode="decimal" value={answer} onChange={e => setAnswer(e.target.value)} onKeyDown={e => e.key === 'Enter' && check()} placeholder="?" className="w-full bg-[#F2F6FF] rounded-2xl py-5 text-center text-3xl font-black text-[#5D5FEF] mb-4 outline-none border-2 border-transparent focus:border-indigo-200 transition-all"/>

                    <button onClick={check} disabled={isCorrect !== null} className={`w-full py-5 rounded-2xl text-white font-black text-lg shadow-xl transition-all active:scale-95 ${isCorrect === true ? 'bg-green-500 shadow-green-100' : isCorrect === false ? 'bg-red-500 shadow-red-100' : 'bg-[#5D5FEF] shadow-indigo-100'}`}>
                        {isCorrect === true ? t.ok : isCorrect === false ? t.no : t.check}
                    </button>

                    <div className="flex justify-between mt-8 text-[10px] font-black uppercase tracking-widest text-gray-300">
                        <span>{t.score}: {stats.c}/{stats.t}</span>
                        <span>{stats.t > 0 ? Math.round(stats.c/stats.t*100) : 0}%</span>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
