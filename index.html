<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilimMath — Тренажер</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .math-card { box-shadow: 0 20px 50px rgba(93, 95, 239, 0.1); border-radius: 40px; }
        .btn-grade { transition: all 0.2s ease; }
        .btn-grade:active { transform: scale(0.9); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-[#F8FAFF] min-h-screen flex items-center justify-center p-4">
    <div id="root"></div>

    <script type="text/babel">
    const { useState, useEffect } = React;

    const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    const generators = {
        1: () => {
            const op = Math.random() > 0.5 ? '+' : '-';
            let n1, n2, ans;
            if (op === '+') { n1 = randomInt(1, 10); n2 = randomInt(1, 10); ans = n1 + n2; }
            else { n1 = randomInt(5, 20); n2 = randomInt(1, n1); ans = n1 - n2; }
            return { q: `${n1} ${op} ${n2} = ?`, ans, topic: {ru: 'Арифметика', kk: 'Арифметика'} };
        },
        2: () => {
            const type = randomInt(1, 2);
            if (type === 1) {
                const a = randomInt(2, 9), b = randomInt(2, 9);
                return { q: `${a} × ${b} = ?`, ans: a * b, topic: {ru: 'Умножение', kk: 'Көбейту'} };
            }
            const n2 = randomInt(2, 9), ans = randomInt(2, 9);
            return { q: `${n2 * ans} : ${n2} = ?`, ans, topic: {ru: 'Деление', kk: 'Бөлу'} };
        },
        3: () => {
            const x = randomInt(5, 50), a = randomInt(10, 40), b = x + a;
            return { q: `x + ${a} = ${b}. x = ?`, ans: x, topic: {ru: 'Уравнения', kk: 'Теңдеулер'} };
        },
        4: () => {
            const a = randomInt(5, 15), b = randomInt(5, 15);
            return { q: `S = ${a}см × ${b}см. S = ?`, ans: a * b, topic: {ru: 'Геометрия', kk: 'Геометрия'} };
        },
        5: () => {
            const type = randomInt(1, 2);
            if (type === 1) {
                const w = randomInt(100, 500), p = randomInt(10, 50);
                return { q: `${w}-дің ${p}%-ы = ?`, ans: Math.round(w * p / 100), topic: {ru: 'Проценты', kk: 'Пайыздар'} };
            }
            const a = randomInt(10, 99) / 10, b = randomInt(10, 99) / 10;
            return { q: `${a} + ${b} = ?`, ans: Math.round((a + b) * 10) / 10, topic: {ru: 'Десятичные дроби', kk: 'Ондық бөлшектер'} };
        },
        6: () => {
            const a = randomInt(-20, -5), b = randomInt(5, 20);
            const op = Math.random() > 0.5 ? '+' : '-';
            return { q: `${a} ${op} (${b}) = ?`, ans: op === '+' ? a + b : a - b, topic: {ru: 'Отрицательные числа', kk: 'Рационал сандар'} };
        },
        7: () => {
            const a = randomInt(2, 7), b = randomInt(5, 20), x = randomInt(2, 10);
            const c = a * x + b;
            return { q: `${a}x + ${b} = ${c}. x = ?`, ans: x, topic: {ru: 'Алгебра', kk: 'Алгебра'} };
        },
        8: () => {
            const type = randomInt(1, 2);
            if (type === 1) {
                const n = randomInt(4, 12);
                return { q: `√${n * n} = ?`, ans: n, topic: {ru: 'Квадратный корень', kk: 'Квадрат түбір'} };
            }
            const x1 = randomInt(1, 5), x2 = randomInt(1, 5);
            const b = -(x1 + x2), c = x1 * x2;
            return { q: `x² + (${b})x + ${c} = 0. Меньший корень?`, ans: Math.min(x1, x2), topic: {ru: 'Квадратные уравнения', kk: 'Квадрат теңдеулер'} };
        },
        9: () => {
            const a1 = randomInt(2, 10), d = randomInt(2, 5);
            return { q: `a₁=${a1}, d=${d}. a₃ = ?`, ans: a1 + 2 * d, topic: {ru: 'Прогрессия', kk: 'Прогрессия'} };
        }
    };

    const App = () => {
        const [grade, setGrade] = useState(1);
        const [lang, setLang] = useState('kk'); // По умолчанию ставим казахский
        const [problem, setProblem] = useState(generators[1]());
        const [answer, setAnswer] = useState('');
        const [isCorrect, setIsCorrect] = useState(null);
        const [stats, setStats] = useState(() => {
            const saved = localStorage.getItem('bilimmath_stats_v2');
            return saved ? JSON.parse(saved) : { correct: 0, total: 0 };
        });

        useEffect(() => {
            localStorage.setItem('bilimmath_stats_v2', JSON.stringify(stats));
        }, [stats]);

        const check = () => {
            if (!answer) return;
            const correct = parseFloat(answer) === problem.ans;
            setIsCorrect(correct);
            setStats(prev => ({ correct: correct ? prev.correct + 1 : prev.correct, total: prev.total + 1 }));
            setTimeout(() => {
                setProblem(generators[grade]());
                setAnswer('');
                setIsCorrect(null);
            }, 1200);
        };

        const t = {
            ru: { score: "Счёт", check: "Проверить", correct: "Верно!", wrong: "Ошибка!" },
            kk: { score: "Ұпай", check: "Тексеру", correct: "Дұрыс!", wrong: "Қате!" }
        }[lang];

        return (
            <div className="math-card bg-white w-full max-w-[480px] p-8 md:p-10 border border-indigo-50">
                <div className="flex justify-between items-center mb-8">
                    <h1 className="text-[#5D5FEF] text-2xl font-black tracking-tight">BilimMath <span className="font-light opacity-60 italic">kz</span></h1>
                    <div className="flex gap-3 font-bold text-xs bg-gray-50 p-1 rounded-xl shadow-inner">
                        <button onClick={() => setLang('kk')} className={`px-4 py-2 rounded-lg transition ${lang === 'kk' ? 'bg-white shadow-sm text-[#5D5FEF]' : 'text-gray-400'}`}>ҚАЗ</button>
                        <button onClick={() => setLang('ru')} className={`px-4 py-2 rounded-lg transition ${lang === 'ru' ? 'bg-white shadow-sm text-[#5D5FEF]' : 'text-gray-400'}`}>РУС</button>
                    </div>
                </div>

                <div className="grid grid-cols-5 gap-2 mb-8">
                    {[1,2,3,4,5,6,7,8,9].map(g => (
                        <button key={g} 
                            onClick={() => {setGrade(g); setProblem(generators[g]()); setAnswer(''); setIsCorrect(null);}}
                            className={`btn-grade py-3 rounded-2xl font-bold text-sm ${grade === g ? 'bg-[#5D5FEF] text-white' : 'bg-[#F2F6FF] text-[#5D5FEF] hover:bg-indigo-50'}`}>
                            {g}
                        </button>
                    ))}
                </div>

                <div className="bg-[#F8FAFF] rounded-[32px] p-10 text-center mb-6 border border-indigo-50/50">
                    <p className="text-[#A5B4FC] font-black tracking-[0.1em] text-[11px] mb-4 uppercase">
                        {problem.topic[lang]}
                    </p>
                    <h2 className="text-4xl md:text-5xl font-black text-[#2D3142] leading-tight">{problem.q}</h2>
                </div>

                <input 
                    type="number"
                    inputMode="decimal"
                    value={answer}
                    onChange={(e) => setAnswer(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && check()}
                    placeholder="?"
                    className="w-full bg-[#F2F6FF] rounded-2xl py-5 text-center text-3xl font-black text-[#5D5FEF] mb-5 outline-none border-2 border-transparent focus:border-[#5D5FEF]/20 transition-all"
                />

                <button 
                    onClick={check}
                    disabled={isCorrect !== null}
                    className={`w-full py-5 rounded-2xl text-white font-black text-lg transition-all shadow-lg
                    ${isCorrect === true ? 'bg-green-500 shadow-green-100' : isCorrect === false ? 'bg-red-500 shadow-red-100' : 'bg-[#5D5FEF] shadow-indigo-100 hover:bg-[#4B4DDB]'}`}>
                    {isCorrect === true ? t.correct : isCorrect === false ? t.wrong : t.check}
                </button>

                <div className="flex justify-between mt-10 text-[#2D3142] font-black text-xs uppercase tracking-widest opacity-30">
                    <span>{t.score}: {stats.correct}/{stats.total}</span>
                    <span>{stats.total > 0 ? Math.round((stats.correct/stats.total)*100) : 0}%</span>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>

